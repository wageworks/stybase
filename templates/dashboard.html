{% extends "base.html" %}
{% set body_role = user.role %}
{% block title %}Dashboard | Stybase{% endblock %}

{% block content %}
<div class="dashboard-container">

    <!-- ---------------- Header ---------------- -->
    <div class="dashboard-header">
        <h2>Welcome, {{ user.username }}</h2>
        <p class="account-type">Account Type: <strong>{{ user.role|capitalize }}</strong></p>
    </div>

    <!-- ---------------- Developer/Admin Section ---------------- -->
    {% if user.role|lower in ['developer', 'admin'] %}
    <div class="dashboard-row">

        <!-- App Request / Register Card -->
        <div class="dashboard-card">
            <div class="card-header">
                <h4>{% if has_pending_request %}Pending App Request{% else %}Register New App{% endif %}</h4>
            </div>
            <div class="card-body">
                {% if has_pending_request %}
                    <p>Your request for "{{ pending_request_name }}" is awaiting admin approval.</p>
                {% else %}
                    <a href="{{ url_for('request_app') }}" class="btn btn-success btn-block">
                        <i class="fas fa-plus-circle"></i> Submit App Request
                    </a>
                {% endif %}
            </div>
        </div>

        <!-- Your Apps Card -->
        <div class="dashboard-card">
            <div class="card-header">
                <h4>Your Apps</h4>
            </div>
            <div class="card-body">
                {% if owned_apps %}
                <ul class="app-list">
                    {% for app in owned_apps %}
                    <li>
                        <strong>{{ app.name }}</strong><br>
                        Client ID: {{ app.client_id }}<br>
                        Redirect URI: {{ app.redirect_uri }}<br>
                        Status: {{ app.status|capitalize }}<br>
                        <div class="app-actions">
                            <a href="{{ url_for('edit_app', app_id=app.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
                            <a href="{{ url_for('revoke_app', app_id=app.id) }}" class="btn btn-sm btn-outline-danger">Revoke</a>
                            <a href="{{ url_for('tutorial', app_id=app.id) }}" class="btn btn-sm btn-outline-info ms-1">
                                <i class="fas fa-book"></i> Tutorial
                            </a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="empty-message">No apps registered yet.</p>
                {% endif %}
            </div>
        </div>

    </div>
    {% endif %}

    <!-- ---------------- User Authorized Apps ---------------- -->
    <div class="dashboard-row">
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h4>Apps You’ve Authorized</h4>
            </div>
            <div class="card-body">
                {% if authorized_apps %}
                <ul class="app-list">
                    {% for app in authorized_apps %}
                    <li>
                        <strong>{{ app.name }}</strong> — Developer: {{ app.developer }}<br>
                        Authorized At: {{ app.authorized_at }}<br>
                        <a href="{{ url_for('revoke_app', app_id=app.client_id) }}" class="btn btn-sm btn-outline-danger">Revoke</a>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="empty-message">You haven’t authorized any apps yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

</div>
{% endblock %}
